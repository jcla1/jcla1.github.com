<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html">
  <meta name="google-site-verification" content="xLdL56j0SwgMQ_zaX9jYVsRdm4THscM3NFAYIRhuVdg" />
  <link href="http://jcla1.com/rss.xml" rel="alternate" title="jcla1.com" type="application/atom+xml" />

	
  <title>Web Audio API overview (Part 1 of 2)</title>
	<meta name="description" content="A blog about tech.">
  <meta name="author" content="Joseph Adams">

  <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen, projection" />
	
</head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Joseph Adams</a>
    <a class="extra" href="/">home</a>
    <a class="extra" href="/about/">about</a>
    <iframe style="border: 0; margin: 0 0 0 1em; padding: 0;"
    src="https://www.gittip.com/jcla1/widget.html" 
    width="48pt" height="20pt"></iframe>
    <!--a class="extra" href="/about/">about</a-->
  </div>
  
  <div id="post">
<h1 id='web_audio_api_overview_part_1_of_2'>Web Audio API overview (Part 1 of 2)</h1>

<p class='meta'> 11 Mar 2012 - Krefeld, Germany</p>

<p>In the next 2 blog posts I&#8217;ll be showing you some essential features of the Web Audio API. You can find its specification <a href='https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html'>here</a>. The Web Audio API provides nearly all the functionality of a normal synthesizer, one of the reasons why it is so powerful.</p>

<p>Anyway let&#8217;s get going. I&#8217;m going to talk you through the source of a little audio visualizer in this post and the next one. <a href='/demos/web-audio-api/web-audio-overview-part2.html'>Here is a demo of the final product.</a> In this first post I&#8217;ll concentrate on <a href='/demos/web-audio-api/web-audio-overview-part1.html'>a simplified version</a>.</p>

<p><strong>WARNING!</strong> These demos will only work in up to date versions of Chrome! (currently 19+)</p>

<p>Now let&#8217;s look at the HTML body structure. In this case it is very simple, it has a main <code>#container</code>, that (as the name says) contains a canvas and an audio element. After that there are a couple of script tags.</p>
<script src='https://gist.github.com/2015620.js?file=body.html'>
</script>
<p>You may already know what the contents of the first script tag are for. It is a shim by <a href='http://paulirish.com'>Paul Irish</a> that makes it easier to use the <code>requestAnimationFrame()</code> (To get more info read his <a href='http://paulirish.com/2011/requestanimationframe-for-smart-animating/'>blog post</a>). I&#8217;m not going to go further into how it works, but all it does <em>really</em> is make user friendlier animations.</p>

<p>The important parts for this blog post are the contents of the 2nd script tag:</p>
<script src='https://gist.github.com/2015620.js?file=main.js'>
</script>
<p>The <code>webkitAudioContext()</code> created, is a context in which the audio interactions take place. Similar to the ones mentioned in my <a href='/blog/2012/01/08/exploring-the-v8-js-engine-part-2/'>previous post</a>.</p>

<p>You could divide it into 2 main parts:</p>

<ul>
<li>The setup</li>

<li>The animation&#8217;s <code>draw</code> function</li>
</ul>
<br />
<h2 id='the_setup'>The setup</h2>

<p>sets up all the variables (except &#8220;freqData&#8221;) and provides information on how each bar drawn should look. The <code>init</code> function connects the source of the audio (the audio element) with the analyzer and connects the analyzer with the destination. i.e. the speakers</p>

<p>You can imagine connecting up <code>source</code>, <code>analyzer</code> and <code>destination</code> as taking a few plugs and plugging them in some hardware. The only difference is that this is virtual!</p>

<h2 id='the_animations__function'>The animation&#8217;s <code>draw</code> function</h2>

<p>takes care of drawing the bars.</p>

<p>But what does that mean <em>exactly</em>?</p>

<ol>
<li>
<p>Call the <code>requestAnimFrame</code> function to restart the animation at just the right time.</p>
</li>

<li>
<p>Create a typed array (called <code>freqData</code>) for holding the individual frequencies. The parameter passed at creation is the size of the array (In this case <code>1024</code> items).</p>
</li>

<li>
<p>Call a function on the analyzer to put the frequencies in <code>freqData</code> (it doesn&#8217;t return anything).</p>
</li>

<li>
<p>Simply clear the canvas.</p>
</li>

<li>
<p>Loop through all the frequency data (except that in the offset) and each time:</p>

<ul>
<li>
<p>Get the current frequency</p>
</li>

<li>
<p>Draw a bar that is as high as the frequency. The magnitude has to be negative here so that the bar is drawn in the correct direction.</p>
</li>
</ul>
</li>

<li>
<p>Lather. Rinse. Repeat.</p>
</li>
</ol>
<hr />
<p>Nearly everything that has to do with the Web Audio API inherits from an object called <code>AudioNode</code>, which contains some basic structure for working with audio. For example the analyzer we are using here is also inherited from <code>AudioNode</code>. Other examples of Audio Nodes are <code>BiquadFilter</code>, <code>LowPassFilter</code>, <code>AudioGainNode</code> and many more. I will be covering some of them in part 2 of this mini series.</p>
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>15 Jun 2012</span> &raquo; <a href="/blog/2012/06/15/getting-to-work-with-codemirror">Getting to work with CodeMirror</a></li>
    
      <li><span>06 Apr 2012</span> &raquo; <a href="/blog/2012/04/06/web-audio-api-overview-part2">Web Audio API overview (Part 2 of 2)</a></li>
    
      <li><span>08 Jan 2012</span> &raquo; <a href="/blog/2012/01/08/exploring-the-v8-js-engine-part-2">Exploring the V8 JS engine (Part 2 of 2)</a></li>
    
  </ul>
</div>
  
  <div class="footer">
    <div class="contact">
      <p>
        Joseph Adams<br />
        <a href="mailto:whitegolem@gmail.com">whitegolem@gmail.com</a><br />
        <a href="http://jcla1.com">jcla1.com</a>
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="http://github.com/jcla1/"><img src="/img/github_32.png"></img></a>
        <a href="http://twitter.com/jcla1/"><img src="/img/twitter_32.png"></img></a>
        <a href="https://plus.google.com/109982208260057168917/posts"><img src="/img/google_32.png"></a>
      </p>
    </div>
    <div class="rss">
      <a href="http://jcla1.com/rss.xml">
        <img src="/img/rss_32.png" alt="Subscribe to RSS Feed" />
      </a>
    </div>
  </div>
</div>

<script>
    var _gaq=[['_setAccount','UA-12395541-8'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>
