var width=860,height=130,cellSize=15,day=function(a){return(a.getDay()+6)%7},week=d3.time.format("%W"),monthDay=d3.time.format("%d"),month=d3.time.format("%b"),format=d3.time.format("%Y/%m/%d"),color=d3.scale.quantile().range(d3.range(8).map(function(a){return"q"+a+"-11"})),svg=d3.select("#netusage").selectAll("svg").data(d3.range(2013,2014)).enter().append("svg").attr("width",width).attr("height",height).attr("class","RdYlGn").append("g").attr("transform","translate(40, 15)");
svg.selectAll("text.day").data("Mon Tue Wed Thu Fri Sat Sun".split(" ")).enter().append("text").style("display",function(a,b){return 0===b%2?"none":void 0}).attr("text-anchor","middle").attr("class","wday").attr("dx",-10).attr("dy",function(a,b){return b*cellSize+10}).text(function(a){return a[0]});
var rect=svg.selectAll(".day").data(function(a){return d3.time.days(new Date(a,0,1),new Date(a+1,0,1))}).enter().append("rect").attr("class","day").attr("width",cellSize).attr("height",cellSize).attr("x",function(a){return week(a)*cellSize}).attr("y",function(a){return day(a)*cellSize}).datum(format);rect.append("title").text(function(a){return a});
svg.selectAll("text.month").data(rect.filter(function(a){return 1==monthDay(format.parse(a))})[0]).enter().append("text").attr("class","month").attr("text-anchor","middle").attr("x",function(a){return+d3.select(a).attr("x")+cellSize+10}).attr("y",-5).text(function(a){return month(format.parse(d3.select(a).data()[0]))});
d3.csv("data/net_usage_daily.csv",function(a,b){d3.format("02d");var c=d3.nest().key(function(a){a=new Date(1E3*parseInt(a.date));return format(a)}).rollup(function(a){return parseFloat(a[0].mib)}).map(b);color.domain(d3.extent(b,function(a){a=parseFloat(a.mib);return 1E-4*a*a}));rect.filter(function(a){return a in c}).attr("class",function(a){return"day "+color(c[a])}).select("title").text(function(a){return a+" "+c[a]+"MiB"})});